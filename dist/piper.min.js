(function(a){function b(){}function f(a){var b;return a=a||"evtpipe"+c++,b=function(b){return eve.apply(eve,[a+"."+b].concat(Array.prototype.slice.call(arguments,1)))},b.emit=b,b.check=function(){var a=f(),c=b.apply(b,Array.prototype.slice.call(arguments))||[];return setTimeout(function(){var b=c.filter(function(a){return typeof a=="function"}),d=!0;c.forEach(function(a){typeof a!="undefined"&&typeof a!="function"&&(d=d&&a)});if(!d)a("fail");else if(b.length===0)a("pass");else{var e=b.length,f=!1;b.forEach(function(b){b(function(b){b&&!f&&(f=!0,a("fail")),e--,e<=0&&!f&&a("pass")})})}},0),a},["_on","_once","unbind","listeners"].forEach(function(c){b[c]=function(b){var e=eve[c.replace(d,"")];return e.apply(eve,[a+"."+b].concat(Array.prototype.slice.call(arguments,1)))}}),["on","once"].forEach(function(c){b[c]=function(d,f){return eve[c].call(eve,a+"."+d,function(){var b=eve.nt(),c=Array.prototype.slice.call(arguments),g,h;return b!==a+"."+d&&(g=b.split(e),h=g[g.length-1],g.length>1&&h[0]==="#"&&(h=h.slice(1),typeof document!="undefined"&&typeof document.getElementById=="function"&&(h=document.getElementById(h)||h),c.unshift(h))),f.apply(this,c)}),b}}),b.nt=function(){return eve.nt().slice(a.length+1)},b.ns=function(){return a},b}function h(a,b){this.eve=a,this.bindings={},typeof b!="undefined"&&!Array.isArray(b)&&(b=[b]),this.transports=b||[]}(function(a){var b="0.3.3",c="hasOwnProperty",d=/[\.\/]/,e="*",f=function(){},g=function(a,b){return a-b},h,i,j={n:{}},k=function(a,b){var c=j,d=i,e=Array.prototype.slice.call(arguments,2),f=k.listeners(a),l=0,m=!1,n,o=[],p={},q=[],r=[];h=a,i=0;for(var s=0,t=f.length;s<t;s++)"zIndex"in f[s]&&(o.push(f[s].zIndex),f[s].zIndex<0&&(p[f[s].zIndex]=f[s]));o.sort(g);while(o[l]<0){n=p[o[l++]],q.push(n.apply(b,e));if(i)return i=d,q}for(s=0;s<t;s++){n=f[s];if("zIndex"in n)if(n.zIndex==o[l]){q.push(n.apply(b,e));if(i)return i=d,q;do{l++,n=p[o[l]],n&&q.push(n.apply(b,e));if(i)return i=d,q}while(n)}else p[n.zIndex]=n;else{q.push(n.apply(b,e));if(i)return i=d,q}}return i=d,q.length?q:null};k.listeners=function(a){var b=a.split(d),c=j,f,g,h,i,k,l,m,n,o=[c],p=[];for(i=0,k=b.length;i<k;i++){n=[];for(l=0,m=o.length;l<m;l++){c=o[l].n,g=[c[b[i]],c[e]],h=2;while(h--)f=g[h],f&&(n.push(f),p=p.concat(f.f||[]))}o=n}return p},k.on=function(a,b){var c=a.split(d),e=j;for(var g=0,h=c.length;g<h;g++)e=e.n,!e[c[g]]&&(e[c[g]]={n:{}}),e=e[c[g]];e.f=e.f||[];for(g=0,h=e.f.length;g<h;g++)if(e.f[g]==b)return f;return e.f.push(b),function(a){+a==+a&&(b.zIndex=+a)}},k.stop=function(){i=1},k.nt=function(a){return a?(new RegExp("(?:\\.|\\/|^)"+a+"(?:\\.|\\/|$)")).test(h):h},k.unbind=function(a,b){var f=a.split(d),g,h,i,k,l,m,n,o=[j];for(k=0,l=f.length;k<l;k++)for(m=0;m<o.length;m+=i.length-2){i=[m,1],g=o[m].n;if(f[k]!=e)g[f[k]]&&i.push(g[f[k]]);else for(h in g)g[c](h)&&i.push(g[h]);o.splice.apply(o,i)}for(k=0,l=o.length;k<l;k++){g=o[k];while(g.n){if(b){if(g.f){for(m=0,n=g.f.length;m<n;m++)if(g.f[m]==b){g.f.splice(m,1);break}!g.f.length&&delete g.f}for(h in g.n)if(g.n[c](h)&&g.n[h].f){var p=g.n[h].f;for(m=0,n=p.length;m<n;m++)if(p[m]==b){p.splice(m,1);break}!p.length&&delete g.n[h].f}}else{delete g.f;for(h in g.n)g.n[c](h)&&g.n[h].f&&delete g.n[h].f}g=g.n}}},k.once=function(a,b){var c=function(){var d=b.apply(this,arguments);return k.unbind(a,c),d};return k.on(a,c)},k.version=b,k.toString=function(){return"You are running Eve "+b},typeof module!="undefined"&&module.exports?module.exports=k:typeof define!="undefined"?define("eve",[],function(){return k}):a.eve=k})(this);var c=0,d=/^_/,e=/[\/\.]/,g=/[\s\,\|]/;h.prototype.addTransport=function(a){this.transports.push(a)},h.prototype.pub=function(a){var b=this;return(a||["*"]).forEach(function(a){b.bindings[a]||b.eve.on(a,b.bindings[a]=function(){var a,c;if(arguments[arguments.length-1]===b)return;a=[b.eve.nt()].concat(Array.prototype.slice.call(arguments)),c=JSON.stringify(a),b.transports.forEach(function(a){a.send(c)})})}),this},h.prototype.sub=function(){function c(c){if(c){try{b=JSON.parse(c)}catch(d){b=c.split(g)}b&&b.length>0&&(b.splice(1,0,null),b.push(a),a.eve.apply(a.eve,b))}}var a=this,b;return this.transports.forEach(function(a){a.sub(c)}),this},h.prototype.unpub=function(){for(var a in this.bindings)this.eve.unbind(a,this.bindings[a]);return this.bindings={},this},h.prototype.unsub=function(){return this.transports.forEach(function(a){a.unsub()}),this},f.bridge=function(a){return new h(eve,a)},f.eve=eve,typeof module!="undefined"&&module.exports?module.exports=f:typeof define!="undefined"?define("piper",[],function(){return f}):a.piper=f})(this)